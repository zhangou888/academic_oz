---
title: 'Introducing Tidyverse-Part 1:Tidy Data'
author: Ou Zhang
date: '2020-05-09'
slug: Tidy data
draft: no
categories: 
  - R
  - Data science
tags:
  - R
  - Data Science
subtitle: ''
summary: ''
authors: []
lastmod: '2020-05-09T23:53:01-05:00'
featured: no
disable_jquery: no
image:
  caption: ''
  focal_point: 'Smart'
  preview_only: no
projects: []
output:
  blogdown::html_page:
    toc: false
    number_sections: yes
    toc_depth: 3
---



<p>In an ideal world, a data analysis process is as simple as-<code>read in data, select a suitable model to fit in data, obtain statistical estimates, and finally, interpret the analysis results</code>. Sounds simple and straight foward, isn’t it?</p>
<p>But, in reality, it’s often not that simple!Data is always messy and often times we need to clean our data before we can make any sense of it. Moreover, some researchers found that more than <code>80%</code> of data analysis is actually spent on data preparation or data manipulation (Dasu &amp; Johnson, 2003), so that the data is transformed int a usable format before you even think about analysis.</p>
<p>Therefore, data cleaning or data wrangling is utmost important for any data analysis or data science project.</p>
<p>In the early 2010s, <a href="http://hadley.nz/">Hadley Wickham</a> invented one of the most important R package series - <a href="https://www.tidyverse.org/">Tidyverse</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:fig1"></span>
<img src="img/tidyverse.png" alt="Tidyverse" width="20%" />
<p class="caption">
Figure 0.1: Tidyverse
</p>
</div>
<p>The <code>tidyverse</code> is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. It mainly focuses on the data wrangling steps including data import/export, data format conversion, data wrangling or data tidying. The ideal data analysis process, or the standard process explained by Hadley looks like the flow chart below.</p>
<div class="figure" style="text-align: center"><span id="fig:fig2"></span>
<img src="img/r4ds_data-science.png" alt="data analysis flow" width="70%" />
<p class="caption">
Figure 0.2: data analysis flow
</p>
</div>
<p>The idea of data tidying is the <code>first step</code> and standard way to structure datasets for later data analysis.</p>
<p>On internet, you can easily googled tons of information and websites introducing this R-package collection. However, most of the introductions, only spend one or two paragraphs to depict the definition of <code>Tidy data</code> then move on to the command line examples and description of relevant package applications. Only Hadley own <a href="https://r4ds.had.co.nz">R for Data Science</a> book, gives an entire chapter to give a detailed story about <code>Tidy data</code>. Because of its importance, Hadley published a paper, only introducing the definition of <code>Tidy data</code>.</p>
<p>You can find the paper from this link: <a href="https://www.jstatsoft.org/index.php/jss/article/view/v059i10/v59i10.pdf">Tidy data</a>.</p>
<p>The paper itself claims the above definitions are <a href="https://en.wikipedia.org/wiki/Third_normal_form"><strong>Codd 3rd normal form</strong></a>.</p>
<p>As a data scientist, personally I think the Tidy data is more than just great. It is not just an idea, but it provides a comprehensive <code>“philosophy of data”</code> in terms of data handling, and data science. For that reason, I would like to write a bit on the meaning and history of the phrase <code>tidy data</code> as my first ever blog series of <code>Tidyverse</code> introduction.</p>
<div id="what-is-tidy-data" class="section level1">
<h1><span class="header-section-number">1</span> What is Tidy data？</h1>
<p>The first question is-What is tidy data?</p>
<p>Tidy data is a specific way of organizing data into a consistent format which plugs into the tidyverse set of packages for R. It is not the only way to store data and there are reasons why you might not store data in this format, but eventually you will probably need to convert your data to a tidy format in order to efficiently analyze it.</p>
<p>There are three rules which make a dataset tidy:</p>
<!-- * Each variable must have its own column -->
<!-- * Each observation must have its own row -->
<!-- * Each value must have its own cell -->
<div class="figure" style="text-align: center"><span id="fig:fig3"></span>
<img src="img/tidy_data.png" alt="data analysis flow" width="75%" />
<p class="caption">
Figure 1.1: data analysis flow
</p>
</div>
<p>Tidy data is particularly well suited for vectorized programming languages like R (R Core Team 2014), because the layout ensures that values of different variables from the same observation are always paired.</p>
<p>Please note that this concept was already well known in statistics and called a <code>data matrix</code>. For example:</p>
<blockquote>
<p>A standard method of displaying a multivariate set of data is in the form of a data matrix in which rows correspond to sample individuals and columns to variables, so that the entry in the ith row and jth column gives the value of the jth variate as measured or observed on the ith individual.</p>
</blockquote>
<blockquote>
<p><em>Krzanowski, W. J., F. H. C. Marriott, Multivariate Analysis Part 1, Edward Arnold, 1994, page 1.</em></p>
</blockquote>
</div>
<div id="why-is-it-important" class="section level1">
<h1><span class="header-section-number">2</span> Why is it important?</h1>
<p>So, the 2nd question is-why is this Tidy data structure important?</p>
<p>The short answer is in three folds.</p>
<ul>
<li>Organizing datasets as tidy data makes data cleaning efforts easier</li>
<li>Broad range of analytical tools are built upon the assumption to consume tidy data</li>
<li>Sharing tidy data increases re-use</li>
</ul>
<p>The figure below displays the tools for tidy data in the Tidyverse package series.</p>
<div class="figure" style="text-align: center"><span id="fig:fig4"></span>
<img src="img/tools_for_tidy.jpg" alt="Tools for Tidy data" width="75%" />
<p class="caption">
Figure 2.1: Tools for Tidy data
</p>
</div>
</div>
<div id="fixed-variable-vs.-measured-variable" class="section level1">
<h1><span class="header-section-number">3</span> Fixed variable vs. Measured variable</h1>
<p>In general, two types of varaibles exist in the tidy data structure, fixed variable and measured variable.</p>
<ul>
<li><p><code>Fixed variable</code> - Fixed variables describe the experimental design and are known in advance.</p></li>
<li><p><code>Measured variable</code> - Measured variables are what we actually measured in the study.</p></li>
</ul>
<p>In the Tidy data structure, fixed variables should come <code>first</code>, followed by measured variables, each ordered so that related variables are contiguous. Rows can then be ordered by the first variable, breaking ties with the second and subsequent (fixed) variables.</p>
</div>
<div id="is-such-a-data-set-tidy" class="section level1">
<h1><span class="header-section-number">4</span> Is such a data set <strong>tidy</strong>?</h1>
<p>While starting data analysis, data scientists should ask themselves a big question before moving on to the real data analysis.</p>
<p>This question is:</p>
<blockquote>
<p>Is this data set <strong>tidy</strong>?</p>
</blockquote>
<p>Let’s look at a couple of data structures and ask yourself this question.</p>
<div id="example-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Example 1:</h2>
<div class="figure" style="text-align: center"><span id="fig:fig5"></span>
<img src="img/data1.png" alt="data 1" width="75%" />
<p class="caption">
Figure 4.1: data 1
</p>
</div>
<p>So, is this data structure a tidy data?</p>
<p>The short answer is <code>No, it's not tidy data</code>. This is because variable 2 to 4 (column 2-4) are all stock price. And according to tidy data rule No. 1-<em>Each variable must have its own column</em>. All three variables should be transform into a single variable to store stock price values and create a new variable to indicate stock names.</p>
</div>
<div id="example-2" class="section level2">
<h2><span class="header-section-number">4.2</span> Example 2:</h2>
<p>Let’s look at the 2nd data example.</p>
<div class="figure" style="text-align: center"><span id="fig:fig6"></span>
<img src="img/data2.png" alt="data 2" width="70%" />
<p class="caption">
Figure 4.2: data 2
</p>
</div>
<p>So, is this data structure a tidy data?</p>
<p>The answer is <code>Yes, it is tidy data</code>. And you can tell that the data structure 2 meet all three conditions of tidy data. Moreover, it is the data structure 1 after tidy data transformation.</p>
</div>
<div id="example-3" class="section level2">
<h2><span class="header-section-number">4.3</span> Example 3:</h2>
<p>Let’s look at the 3rd data example to reinforce the tidy data idea.</p>
<div class="figure" style="text-align: center"><span id="fig:fig7"></span>
<img src="img/data3.png" alt="data 3" width="70%" />
<p class="caption">
Figure 4.3: data 3
</p>
</div>
<p>So, is this data structure a tidy data?</p>
<p><code>Yes, it is tidy data</code>. And you can tell that the data structure 3 is similar to the data structure 2 with only 3rd variable differences. It meets all three conditions of tidy data as well.</p>
</div>
<div id="code-examples" class="section level2">
<h2><span class="header-section-number">4.4</span> Code Examples</h2>
<p>So, you’ve seen some data examples and let’s run some dynamic codes as tidy data examples. The code below display the same data with 4 different structures. One dataset (tidy data structure) is much easier to work with in R than others.</p>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;fct&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Data 1 is tidy data structure. This is because each variable has its own column (i.e., country, year, cases, and population). And each observation has its own row. Finally, each value has its own cell.</p>
<pre><code>## # A tibble: 12 x 4
##    country      year key             value
##    &lt;fct&gt;       &lt;int&gt; &lt;fct&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>Data 2 intermingles the values of population and cases in the same column-value. So, data 2 is not tidy data.</p>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
##   &lt;fct&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p>The case and population variables in data 3 are in the same column.</p>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
##   &lt;fct&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<p>data 4 only includes the case variable and the population variable is missing.</p>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
##   &lt;fct&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<p>data 5 only includes the population variable, and the case variable is missing in the dataset.</p>
</div>
</div>
<div id="traditional-measurement-testing-dataset" class="section level1">
<h1><span class="header-section-number">5</span> Traditional measurement testing dataset</h1>
<p>As psychometricians, the data we usually encounter is the traditional measurement testing data. In order to fit the data into the traditional IRT or CTT software (i.e., WINSTEPS), the data structures are either item score matrix,</p>
<div class="figure" style="text-align: center"><span id="fig:fig8"></span>
<img src="img/measure_data1.JPG" alt="measurement data type 1-item score" width="60%" />
<p class="caption">
Figure 5.1: measurement data type 1-item score
</p>
</div>
<p>or item response matrix,</p>
<div class="figure" style="text-align: center"><span id="fig:fig9"></span>
<img src="img/measure_data2.JPG" alt="measurement data type 1-item responses" width="60%" />
<p class="caption">
Figure 5.2: measurement data type 1-item responses
</p>
</div>
<p>These 2 data structures are <code>NOT</code> tidy data.</p>
<p>Is this a big problem for psychometrics using tidy data structure?</p>
<p>The answer is <code>NO</code>.</p>
<p>For the psychometrics, we can still apply tidy data structure in our works, because psychometrician or data scientist could always develop a standard data conversion module to transform the standard tidy data structure to the special data format customized for the traditional testing statistics software usage.</p>
</div>
